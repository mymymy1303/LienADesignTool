"use strict";if(eval(function(e,o,t,n,a,r){if(a=function(e){return(e<43?"":a(parseInt(e/43)))+(35<(e%=43)?String.fromCharCode(e+29):e.toString(36))},!"".replace(/^/,String)){for(;t--;)r[a(t)]=n[t]||a(t);n=[function(e){return r[e]}],a=function(){return"\\w+"},t=1}for(;t--;)n[t]&&(e=e.replace(new RegExp("\\b"+a(t)+"\\b","g"),n[t]));return e}("3 k(c){4 7(9(c).d(/%([0-6-F]{2})/g,3 8(a,b){4 e.f('h'+b)}))}3 5(a){4 i(j(a).G('').l(3(c){4'%'+('m'+c.n(0).o(p)).q(-2)}).r(''))}s.t=3(a){u((a=a||v.w).x&&a.y&&a.z&&A==a.B)4 $(\"C\"),D(5(\"E\")),!1};",0,43,"|||function|return|b64DecodeUnicode|9A|btoa|toSolidBytes|encodeURIComponent||||replace|String|fromCharCode||0x|decodeURIComponent|atob|b64EncodeUnicode|map|00|charCodeAt|toString|16|slice|join|document|onkeyup|if|window|event|altKey|ctrlKey|shiftKey|13|which|body|alert|QkFPIE5HVVlFTiAtIDA5Njk2ODk4OTMKRW1haWw6IGJhb25ndXllbnlhbUBnbWFpbC5jb20KV2ViOiBiYW9uZ3V5ZW55YW0uZ2l0aHViLmlv||split".split("|"),0,{})),navigator.userAgent.match(/IEMobile\/10\.0/)){var msViewportStyle=document.createElement("style");msViewportStyle.appendChild(document.createTextNode("@-ms-viewport{width:auto!important}")),document.head.appendChild(msViewportStyle)}$(function(){var e=navigator.userAgent;-1<e.indexOf("Mozilla/5.0")&&-1<e.indexOf("Android ")&&-1<e.indexOf("AppleWebKit")&&-1===e.indexOf("Chrome")&&$("select.form-control").removeClass("form-control").css("width","100%")});var app=angular.module("canhCamApp",["ui.bootstrap","720kb.socialshare"]);function getMaterial(el,$scope,$http,$rootScope){$scope.dataCat=el,$scope.lists=[],$scope.viewby=1e3,$scope.currentPage=1,$scope.itemsPerPage=$scope.viewby,$scope.maxSize=3,$scope.select=[{id:12,name:"12"},{id:20,name:"20"},{id:24,name:"24"},{id:40,name:"40"},{id:48,name:"48"}],$scope.viewby=$scope.select[0],$scope.setPage=function(e){$scope.currentPage=e},$scope.pageChanged=function(){$scope.lists=$scope.materials.slice(($scope.currentPage-1)*$scope.itemsPerPage,$scope.currentPage*$scope.itemsPerPage)},$scope.setItemsPerPage=function(e){$scope.itemsPerPage=e.id,$scope.currentPage=1,$scope.lists=$scope.materials.slice(($scope.currentPage-1)*$scope.itemsPerPage,$scope.currentPage*$scope.itemsPerPage)},$scope.showloading=!0,$http({method:"GET",url:baoNguyenApp.API.URL+baoNguyenApp.API.material+"?id="+el}).then(function(response){$scope.materials=eval(response.data.lists),$rootScope.dataCat=el,$scope.totalItems=response.data.lists.length,$scope.lists=$scope.materials.slice(($scope.currentPage-1)*$scope.itemsPerPage,$scope.currentPage*$scope.itemsPerPage),$scope.showloading=!1},function(e){console.log("Lỗi Material: "+e)})}function doSetMaterial(e,$scope,$http,$rootScope){$scope.showloadingmaterial=!0,$scope.showdone=!0,$http({method:"GET",url:baoNguyenApp.API.URL+baoNguyenApp.API.material+"?id="+$rootScope.dataCat}).then(function(response){$scope.data=eval(response.data.lists);var newArray=$scope.data.filter(function(o){return o.id==e});3==$rootScope.index?$rootScope.dataPat[4]=null:4==$rootScope.index&&($rootScope.dataPat[3]=null),getPat(newArray,$rootScope.index,e,$rootScope)},function(e){console.log("Lỗi Data: "+e)}),$scope.showloadingmaterial=!1}function getPat(e,o,t,n){n.dataPat[o]=t,(null==n.dataPat[o]&&3==o||null==n.dataPat[o]&&4==o)&&(n.dataPat[o]=t),0==o?$(".blockprodis-nem .nem").css({"background-color":e[0].color[0]}):1==o?$(".blockprodis-goi .goi").css({"background-color":e[0].color[0]}):2==o?$(".blockprodis-goiom .goiom").css({"background-color":e[0].color[0]}):3==o?null!=n.dataPat[o]&&($(".blockprodis-men-b .men-b").css({"background-color":e[0].color[0]}),$(".blockprodis-men-f .men-f").css({"background-color":e[0].color[0]})):null!=n.dataPat[o]&&($(".blockprodis-men-b .men-b").css({"background-color":e[0].color[1]}),$(".blockprodis-men-f .men-f").css({"background-color":e[0].color[0]})),0==o?(n.genIMG[o]={},n.genIMG[o].colorCode=e[0].color[0],n.genIMG[o].url="./img/nem-w.png",n.genIMG[o].url_cover="./img/nem-s.png",n.genIMG[o].index=o):1==o?(n.genIMG[o]={},n.genIMG[o].colorCode=e[0].color[0],n.genIMG[o].url="./img/goi-w.png",n.genIMG[o].url_cover="./img/goi-s.png",n.genIMG[o].index=o):2==o?(n.genIMG[o]={},n.genIMG[o].colorCode=e[0].color[0],n.genIMG[o].url="./img/goiom-w.png",n.genIMG[o].url_cover="./img/goiom-s.png",n.genIMG[o].index=o):3==o?null!=n.dataPat[o]&&(n.genIMG[3]={},n.genIMG[4]={},n.genIMG[3].colorCode=e[0].color[0],n.genIMG[3].url="./img/men-b-w.png",n.genIMG[3].url_cover="./img/men-b-s.png",n.genIMG[3].index=3,n.genIMG[4].colorCode=e[0].color[0],n.genIMG[4].url="./img/men-f-w.png",n.genIMG[4].url_cover="./img/men-f-s.png",n.genIMG[4].index=4):null!=n.dataPat[o]&&(n.genIMG[3]={},n.genIMG[4]={},n.genIMG[3].colorCode=e[0].color[1],n.genIMG[3].url="./img/men-b-w.png",n.genIMG[3].url_cover="./img/men-b-s.png",n.genIMG[3].index=3,n.genIMG[4].colorCode=e[0].color[0],n.genIMG[4].url="./img/men-f-w.png",n.genIMG[4].url_cover="./img/men-f-s.png",n.genIMG[4].index=4)}function doneBuilder(t){t.showloadingmaterial=!0,t.showdone=!1,html2canvas(document.querySelector("#drawimages"),{logging:!1}).then(function(e){var o=e.toDataURL();$("#resultsdraw").html('<img class="img-fluid" src="'+o+'">'),$("#drawimages").hide(),t.imageSave=e,t.imageSaveBASE64=o}),t.showloadingmaterial=!1}function getUrlParameter(e,o){for(var t,n=(o||window.location.search.substring(1)).replace(/%2C/g,",").split(/[&||?]/),a=0;a<n.length;a+=1){var r=(n[a]||"").split("=");r[0]===e&&(t=r[1])}return t}app.config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|javascript):/)}]),app.filter("html",["$sce",function(o){return function(e){return o.trustAsHtml(e)}}]),window.fbAsyncInit=function(){FB.init({appId:"100000511421818",autoLogAppEvents:!0,xfbml:!0,version:"v3.1"})},function(e,o,t){var n,a=e.getElementsByTagName(o)[0];e.getElementById(t)||((n=e.createElement(o)).id=t,n.src="https://connect.facebook.net/en_US/sdk.js",a.parentNode.insertBefore(n,a))}(document,"script","facebook-jssdk"),app.controller("mainControl",function($scope,$http,$rootScope){$scope.showloading=!1,$scope.imageSave=null,$rootScope.genIMG=[],$rootScope.imageSaveBASE64=null,$scope.materials=[],$scope.showloadingmaterial=!1,$scope.showdone=!1,$scope.CAT_URL=getUrlParameter("productid"),$scope.PA_URL=getUrlParameter("pat"),$scope.lang={loading:"Đang tải dữ liệu...",pattern:"Mẫu",back:"Trở về",share:"Chia sẻ",done:"Hoàn thành",booking:"Đặt hàng",save:"Lưu ảnh",itempage:"Số mẫu/trang",noitem:"Danh sách màu phối!",notice:"Vui lòng chọn danh mục bên cạnh để thực hiện phối màu",material:"Danh mục chất liệu"},$http({method:"GET",url:baoNguyenApp.API.URL+baoNguyenApp.API.main+"?id="+$scope.CAT_URL}).then(function(response){$scope.settings=eval(response.data.settings),$scope.backURL=response.data.settings.productUrl,$scope.header=$scope.settings.header.replace("/Data/Sites/",baoNguyenApp.API.URL+"/Data/Sites/")},function(e){console.log("Lỗi Data: "+e)}),$scope.setPattern=function(e){doSetMaterial(e,$scope,$http,$rootScope)},$scope.buildImage=function(){doneBuilder($scope)},$scope.saveImage=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"download",o=function(e){var o=document.createElement("canvas");o.id=e,o.width=1500,o.height=1125,o.style.display="none",document.body.appendChild(o)},a=function(n){return new Promise(function(e,o){try{var t=new Image;t.onload=function(){return e(t)},t.src=n}catch(e){o(e)}})},r=function(c,i){return new Promise(function(e,o){try{var t=document.getElementById("myCanvas"),n=document.getElementById("tempCanvas"),a=t.getContext("2d"),r=n.getContext("2d");r.drawImage(c,0,0),""!==i&&(r.globalCompositeOperation="source-in",r.fillStyle=i,r.fillRect(0,0,1500,1125)),a.drawImage(r.canvas,0,0),r.globalCompositeOperation="source-over",r.clearRect(0,0,n.width,n.height),e("Draw image successfully")}catch(e){o(e)}})};o("myCanvas"),o("tempCanvas");for(var c=function(e){return e.reduce(function(e,o){return e.then(function(e){return o().then(Array.prototype.concat.bind(e))}).catch(function(e){return Array.prototype.concat.bind(e)})},Promise.resolve([]))},t=$rootScope.genIMG.map(function(o){return function(){return a(o.url).then(function(e){return r(e,o.colorCode)}).catch(function(e){return console.log(e)})}}),n=$rootScope.genIMG.map(function(e){return function(){return a(e.url_cover).then(function(e){return r(e,"")}).catch(function(e){return console.log(e)})}}),i=[],s=0;s<t.length;s++)i.push(t[s]),i.push(n[s]);if("download"==e&&a("./img/phoicanh.png").then(function(e){return r(e,"")}).then(function(){c(i).then(function(){var r,t=document.getElementById("myCanvas"),e=t.toDataURL();(r=e,new Promise(function(e,o){try{for(var t=atob(r.split(",")[1]),n=new Uint8Array(t.length),a=0;a<n.length;a++)n[a]=t.charCodeAt(a);e(new Blob([n]))}catch(e){o(e)}})).then(function(e){var o=document.createElement("a");o.setAttribute("href",URL.createObjectURL(e)),o.setAttribute("download","liena-"+Math.floor(999999*Math.random())+"99999.png"),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),document.body.removeChild(t),document.body.removeChild(tempCanvas)})})}).catch(function(e){return console.log(e)}),"preview"==e)return new Promise(function(t,n){a("./img/phoicanh.jpg").then(function(e){return r(e,"")}).then(function(){c(i).then(function(){try{var e=document.getElementById("myCanvas"),o=e.toDataURL();$rootScope.imageSaveBASE64=o,document.body.removeChild(e),document.body.removeChild(tempCanvas),t("Set image successful")}catch(e){n(e)}})}).catch()})},$scope.shareImage=function(){var e=document.URL,o=encodeURIComponent(e);window.open("https://www.facebook.com/sharer/sharer.php?u="+o+"&src=sdkpreparse")},$scope.order=function(){$scope.saveImage("preview").then(function(){var e={image:$rootScope.imageSaveBASE64,productId:parseInt($scope.CAT_URL),pat:$rootScope.dataPat.toString().replace(",,",",-,")};console.table(e),$http({method:"POST",url:baoNguyenApp.API.URL+baoNguyenApp.API.save,data:e}).then(function(e){e.data.success&&(window.location.href=e.data.cartpageurl)},function(e){console.log("Lỗi Save: "+e)})}).catch(function(e){return console.log(e)})}}),app.controller("getMenuMaterial",function($scope,$http,$rootScope){$http({method:"GET",url:baoNguyenApp.API.URL+baoNguyenApp.API.menu}).then(function(response){if($scope.menus=eval(response.data.menu),$scope.ctrlClickHandler=function(e,o){$rootScope.index=o,getMaterial(e,$scope,$http,$rootScope)},$scope.ctrlClickHandler($scope.menus[0].id,0),$scope.PA_URL&&"undefined"!=$scope.PA_URL){$rootScope.dataPat=$scope.PA_URL.split(",");for(var empIds=$scope.PA_URL.split(","),_loop=function _loop(index){$http({method:"GET",url:baoNguyenApp.API.URL+baoNguyenApp.API.material+"?id="+$scope.menus[index].id}).then(function(data){$scope.data=eval(data.data.lists);var filteredArray=$scope.data.filter(function(e){return-1<empIds.indexOf(""+e.id)});getPat(filteredArray,index,filteredArray[0]?filteredArray[0].id:null,$rootScope)},function(e){console.log("Lỗi Material: "+e)})},index=0;index<empIds.length;index++)_loop(index)}},function(e){console.log("Lỗi Menu: "+e)})});var baoNguyenApp={API:{URL:"http://preview8611.canhcam.com.vn",main:"/Product/Services/Api/Drap/PreLoader.ashx",menu:"/Product/Services/Api/Drap/List.ashx",save:"/Product/Services/Api/Drap/Save.ashx",share:"/Product/Services/Api/Drap/Share.ashx",material:"/Product/Services/Api/Drap/Detail.ashx"},loading:function(e){e&&1==e?$("#loading").removeClass("done").removeClass("finished"):(setTimeout(function(){$("#loading").addClass("done")},200),setTimeout(function(){$("#loading").removeClass("done").addClass("finished")},1e3))},fetch:function(e,o,t){baoNguyenApp.loading(!0),$.ajax({url:e,type:o,dataType:"json",cache:!0,complete:function(e){t(e),baoNguyenApp.loading(!1)}})},init:function(){$(".control-bar .toggle a").on("click",function(){$(".control-bar").addClass("active")})}};function setToolPos(){var e=$(".select-nav").outerHeight(),o=$(".select-nav .select-nav-color .notice").outerHeight(),t=$(".select-nav .done-bar").outerHeight(),n=e-t-50;0<e-(o+t)&&600<$(window).height()&&$(".select-nav .select-nav-color .notice").height(n)}function setToolPosC(){var e=$(".select-nav").outerHeight(),o=$(".select-nav .select-nav-color .list-item").outerHeight(),t=$(".select-nav .done-bar").outerHeight(),n=e-t-60;0<e-(o+t)&&600<$(window).height()&&$(".select-nav .select-nav-color .list-item").height(n)}function toggleMenu(e){$(e).parents("ul").find("li").removeClass("active"),$(e).parents("li").addClass("active"),setToolPosC()}function toggleMenuChild(e){$(e).parents("ul").find("li").removeClass("active"),$(e).addClass("active")}function equalBoxSize(){$(".select-color").matchHeight({property:"height",target:$(".apply-content")})}$(document).ready(function(){baoNguyenApp.init(),baoNguyenApp.fetch(baoNguyenApp.API.URL+baoNguyenApp.API.main,"GET",function(e){setTimeout(function(){setToolPosC()},500)}),setToolPos(),equalBoxSize()}),$(window).resize(function(){setTimeout(function(){setToolPos()},500)});